<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Implement the Bayesian hierarchical PopReconstruct model — popReconstruct_fit • popMethods</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Implement the Bayesian hierarchical PopReconstruct model — popReconstruct_fit" />
<meta property="og:description" content="The popReconstruct model embeds the cohort component method of population
projection (ccmpp) in a Bayesian hierarchical model. It reconciles
ccmpp input preliminary estimates of sex-ratio at birth, fertility,
mortality, migration, and a baseline population with population data while
accounting for measurement error in these initial estimates.
popReconstruct_fit() fits the model using Stan or
TMB.
popReconstruct_posterior_draws() produces draws from the posterior
distribution.
popReconstruct_prior_draws() produces draws from the prior distribution.
popReconstruct_summarize_draws() produces summary statistics of draws from
the popReconstruct model using demUtils::summarize_dt(). The
summarize_cols parameter should include 'chain', 'chain_draw' and 'draw'
when the model was fit with stan and just 'draw' when the model was fit with
tmb." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">popMethods</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/popReconstruct.html">popReconstruct Model</a>
    </li>
    <li>
      <a href="../articles/popReconstruct_options.html">popReconstruct Alternative Model Specifications</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ihmeuw-demographics/popMethods/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Implement the Bayesian hierarchical PopReconstruct model</h1>
    <small class="dont-index">Source: <a href='https://github.com/ihmeuw-demographics/popMethods/blob/master/R/popReconstruct_fit.R'><code>R/popReconstruct_fit.R</code></a>, <a href='https://github.com/ihmeuw-demographics/popMethods/blob/master/R/popReconstruct_draws.R'><code>R/popReconstruct_draws.R</code></a></small>
    <div class="hidden name"><code>popReconstruct_fit.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The popReconstruct model embeds the cohort component method of population
projection (ccmpp) in a Bayesian hierarchical model. It reconciles
ccmpp input preliminary estimates of sex-ratio at birth, fertility,
mortality, migration, and a baseline population with population data while
accounting for measurement error in these initial estimates.</p>
<p><code>popReconstruct_fit()</code> fits the model using <a href='https://mc-stan.org/'>Stan</a> or
<a href='https://kaskr.github.io/adcomp/Introduction.html'>TMB</a>.</p>
<p><code>popReconstruct_posterior_draws()</code> produces draws from the posterior
distribution.</p>
<p><code>popReconstruct_prior_draws()</code> produces draws from the prior distribution.</p>
<p><code>popReconstruct_summarize_draws()</code> produces summary statistics of draws from
the popReconstruct model using <code><a href='https://rdrr.io/pkg/demUtils/man/summarize_dt.html'>demUtils::summarize_dt()</a></code>. The
<code>summarize_cols</code> parameter should include 'chain', 'chain_draw' and 'draw'
when the model was fit with stan and just 'draw' when the model was fit with
tmb.</p>
    </div>

    <pre class="usage"><span class='fu'>popReconstruct_fit</span>(
  <span class='kw'>inputs</span>,
  <span class='kw'>data</span>,
  <span class='kw'>hyperparameters</span>,
  <span class='kw'>settings</span>,
  <span class='kw'>value_col</span>,
  <span class='kw'>software</span>,
  <span class='kw'>...</span>
)

<span class='fu'>popReconstruct_posterior_draws</span>(
  <span class='kw'>fit</span>,
  <span class='kw'>inputs</span>,
  <span class='kw'>settings</span>,
  <span class='kw'>value_col</span>,
  <span class='kw'>software</span>,
  <span class='kw'>method_name</span>
)

<span class='fu'>popReconstruct_prior_draws</span>(
  <span class='kw'>inputs</span>,
  <span class='kw'>hyperparameters</span>,
  <span class='kw'>settings</span>,
  <span class='kw'>value_col</span>,
  <span class='kw'>method_name</span>,
  chunk_size = <span class='fl'>100</span>
)

<span class='fu'>popReconstruct_summarize_draws</span>(
  <span class='kw'>draws</span>,
  summarize_cols = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"chain"</span>, <span class='st'>"chain_draw"</span>, <span class='st'>"draw"</span>),
  value_col = <span class='st'>"value"</span>,
  <span class='kw'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>inputs</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>]<br />
[<code>data.table()</code>] for each ccmpp input. Requires 'srb', 'asfr', 'baseline',
and 'survival'; and migration estimates provided as just 'net_migration' or
both 'immigration' and 'emigration'. See <strong>Section: Inputs</strong> for more
information on each of the required inputs.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>]<br />
[<code>data.table()</code>] for each type of data input for the model (currently
only 'population'). See <strong>Section: Data</strong> for more information.</p></td>
    </tr>
    <tr>
      <th>hyperparameters</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>]<br />
List for each model component ('srb', 'asfr', ...) that itself contains a
list specifying the alpha (shape) and beta (scale) hyperparameters for the
variance of each model component.</p></td>
    </tr>
    <tr>
      <th>settings</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>]<br />
Named list of settings for running the popReconstruct model with. The
required settings are the same as those required for <code><a href='https://rdrr.io/pkg/demCore/man/ccmpp.html'>demCore::ccmpp()</a></code>,
see <strong>Section: Settings</strong> for these. The optional settings specific to
popReconstruct are described in
<strong>Section: Optional popReconstruct Settings</strong></p></td>
    </tr>
    <tr>
      <th>value_col</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
Name of the column containing the value of interest in each of the
<code>inputs</code>. Default is 'value'.</p></td>
    </tr>
    <tr>
      <th>software</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br />
Statistical modeling software to fit popReconstruct with. Either 'stan' or
'tmb' are available.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>For <code>popReconstruct_fit()</code> additional arguments to pass to
<code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html'>rstan::sampling()</a></code> if fitting the model with 'stan' or
<code><a href='https://rdrr.io/pkg/optimx/man/optimx.html'>optimx::optimx()</a></code> if fitting the model with 'tmb'. For
<code>popReconstruct_summarize_draws()</code> additional arguments to pass to
<code><a href='https://rdrr.io/pkg/demUtils/man/summarize_dt.html'>demUtils::summarize_dt()</a></code>.</p></td>
    </tr>
    <tr>
      <th>fit</th>
      <td><p>[<code>stanfit(1)</code>] or [<code>sdreport(1)</code>]<br />
Model fit object returned by <code>popReconstruct_fit()</code>.</p></td>
    </tr>
    <tr>
      <th>method_name</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
Description to assign to column 'method' in each returned data.table.</p></td>
    </tr>
    <tr>
      <th>chunk_size</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/integer.html'>integer(1)</a></code>]<br />
number of draws to sample from the prior at once.</p></td>
    </tr>
    <tr>
      <th>draws</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>] of [<code>data.table()</code>]<br />
Draws from the posterior distribution of the popReconstruct model as
returned by <code>popReconstruct_posterior_draws()</code>.</p></td>
    </tr>
    <tr>
      <th>summarize_cols</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br />
The <code>id_cols</code> that should be collapsed and to calculate summary statistics
over.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="optional-popreconstruct-settings"><a class="anchor" href="#optional-popreconstruct-settings"></a>Optional popReconstruct Settings</h2>

    

<ul>
<li><p>fixed_parameters: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br />
Names of <code><a href='https://rdrr.io/pkg/demCore/man/ccmpp.html'>demCore::ccmpp()</a></code> input components that should be fixed in
the model, corresponds to the names of the <code>input</code> list. Defaults to
empty if fitting the model for both sexes, if only 'female' then defaults
to 'srb'.</p></li>
<li><p>n_draws: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br />
The number of draws to take from the output posterior distribution. If
fitting the model with stan then the number of draws is dictated by
<code>chains</code>, <code>iterations</code>, <code>burn-in</code>, <code>thin</code> arguments to <code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html'>rstan::sampling</a></code>;
<code>n_draws</code> can then be used to subsample down.</p></li>
<li><p>k_years_input_name: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>]<br />
The start of each calendar year interval that will be knots in the
B-spline linear basis functions for the year-specific input estimates,
so not relevant for 'baseline'. Defaults to the setting for 'years' which
is equal to the original popReconstruct model without linear B-splines
to reduce year-specific parameters.</p></li>
<li><p>k_ages_input_name: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>]<br />
The start of each age-group interval that will be knots in the B-spline
linear basis functions for the age-specific input estimates, so not
relevant for 'srb'. Defaults to the setting for 'ages' (or
'ages_input_name') which is equal to the original popReconstruct model
without linear B-splines to reduce age-specific parameters.</p></li>
</ul>

    <h2 class="hasAnchor" id="data"><a class="anchor" href="#data"></a>Data</h2>

    

<p>population: [<code>data.table()</code>]<br /></p><ul>
<li><p>year: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] year of population data.</p></li>
<li><p>sex: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>] either 'female', 'male', or 'both'. If 'sexes'
<code>setting</code> is 'female' can only have 'female' input data.</p></li>
<li><p>age_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the age group (inclusive).
Corresponds to 'ages' <code>setting</code>. Age groups included must not overlap.</p></li>
<li><p>age_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the age group (exclusive).</p></li>
<li><p><code>value_col</code>: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>] population count, must be greater than zero.</p></li>
</ul>

    <h2 class="hasAnchor" id="popreconstruct-fit-value"><a class="anchor" href="#popreconstruct-fit-value"></a><code>popReconstruct_fit</code> Value</h2>

    

<p>If fit using 'stan' an object of class <code>stanfit</code> and if fit using 'tmb' an
object of class <code>sdreport</code>. Either represents the fitted results that can be
extracted using <code>popReconstruct_posterior_draws()</code>. Stan has helper packages
that can be used to explore the model fit through <code>shinystan</code>, <code>bayesplot</code>,
etc.</p>
    <h2 class="hasAnchor" id="popreconstruct-posterior-draws-and-popreconstruct-prior-draws-value"><a class="anchor" href="#popreconstruct-posterior-draws-and-popreconstruct-prior-draws-value"></a><code>popReconstruct_posterior_draws</code> and <code>popReconstruct_prior_draws</code> Value</h2>

    


<p><code>popReconstruct_posterior_draws()</code> and <code>popReconstruct_prior_draws()</code> return a
named [<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>] of [<code>data.table()</code>] for draws from the posterior and
prior distribution respectively for each ccmpp input component along with the
associated offset and spline offset parameters. Draws for the 'variance' and
projected 'population' are also included.</p>
<p>The returned [<code>data.table()</code>]s will include columns related to the draw
number:</p><ul>
<li><p>draw: the draw index.</p></li>
<li><p>chain: if using stan to fit the model, the chain the draw came from.</p></li>
<li><p>chain_draw: if using stan to fit the model, the draw index for that chain.</p></li>
</ul>

<p>population: [<code>data.table()</code>]<br /></p><ul>
<li><p>year: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] mid-year for population estimate.
Corresponds to 'years' <code>setting</code> plus an extra interval.</p></li>
<li><p>sex: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>] either 'female' or 'male'. Corresponds to 'sexes'
<code>setting</code>.</p></li>
<li><p>age_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the age group (inclusive).
Corresponds to 'ages' <code>setting</code>.</p></li>
<li><p>age_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the age group (exclusive).</p></li>
<li><p>draw: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] draw index.</p></li>
<li><p><code>value_col</code>: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>] projected population count estimates.</p></li>
</ul>

<p>variance: [<code>data.table()</code>]<br /></p><ul>
<li><p>parameter: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>] the ccmpp component the variance term
corresponds to.</p></li>
<li><p>draw: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] draw index.</p></li>
<li><p><code>value_col</code>: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>] estimated variance value..</p></li>
</ul>

<p>For each ccmpp component ('srb', 'asfr', etc.) there will be three
[<code>data.table()</code>] outputs included in the returned [<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>]. These will
each have the same columns as described in the <strong>Section: Inputs</strong> but with
additional draw related columns as described above.</p><ol>
<li><p>The offset parameters representing the values of the piecewise linear
function at the year- and age-specific knots. These are the estimated
deviations from the initial ccmpp input estimates at the exact knots. The
estimated values are in the transformed modeling space (log transformed for
'srb', logit transformed for 'survival', etc.).</p></li>
<li><p>The spline offset values calculated by multiplying the fixed B-spline
linear basis functions by the offset parameters. These are the estimated
deviations from the initial ccmpp input estimates at all years and ages. The
estimated values are in the transformed modeling space.</p></li>
<li><p>The actual ccmpp input posterior draws after combining the spline offset
values with the initial ccmpp input estimates and after applying the inverse
of the transformation used to model each component.</p></li>
</ol>

    <h2 class="hasAnchor" id="popreconstruct-summarize-draws-value"><a class="anchor" href="#popreconstruct-summarize-draws-value"></a><code>popReconstruct_summarize_draws</code> Value</h2>

    

<p>Returns a named [<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>] of [<code>data.table()</code>] for summary statistics
of the input <code>draws</code>. Each <code>data.table()</code> will have the <code>id_cols</code> for each
component (minus the <code>summarize_cols</code>) plus summary statistic columns.
The summary statistic columns have the same name as each function specified
in <code>summary_fun</code> and the quantiles are named like 'q_(<code>probs</code> * 100)'. See
<code>[demUtils::summarize_dt()</code>] for more information.</p>
    <h2 class="hasAnchor" id="settings"><a class="anchor" href="#settings"></a>Settings</h2>

    


<ul>
<li><p>years: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>]<br />
The start of each calendar year interval to project in <code><a href='https://rdrr.io/pkg/demCore/man/ccmpp.html'>demCore::ccmpp()</a></code>.
Corresponds to the 'year_start' column in each of the year-specific inputs.</p></li>
<li><p>sexes: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br />
The sexes being projected in <code><a href='https://rdrr.io/pkg/demCore/man/ccmpp.html'>demCore::ccmpp()</a></code>, must be either just
'female', or 'female' and 'male'. Corresponds to the 'sex' column in each
of the sex-specific inputs.</p></li>
<li><p>ages: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>]<br />
The ages being projected in <code><a href='https://rdrr.io/pkg/demCore/man/ccmpp.html'>demCore::ccmpp()</a></code>. Corresponds to the
'age_start' column in each of the standard age-specific inputs.</p></li>
<li><p>ages_survival: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>]<br />
The ages for which survivorship ratio estimates are available, includes one
extra age group compared to the 'ages' setting. Corresponds to the
'age_start' column in the 'survival' [<code>data.table()</code>] input.</p></li>
<li><p>ages_asfr: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>]<br />
The assumed female reproductive ages, subset of 'ages'. Corresponds to the
'age_start' column in the age-specific fertility rate (asfr)
[<code>data.table()</code>] input.</p></li>
</ul>


    <h2 class="hasAnchor" id="inputs"><a class="anchor" href="#inputs"></a>Inputs</h2>

    


<p>srb: [<code>data.table()</code>]<br /></p><ul>
<li><p>year_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the calendar year interval
(inclusive). Corresponds to 'years' <code>setting</code>.</p></li>
<li><p>year_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the calendar year interval (exclusive).</p></li>
<li><p><code>value_col</code>: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>] sex-ratio at birth estimates, must be
greater than zero.</p></li>
</ul>

<p>asfr: [<code>data.table()</code>]<br /></p><ul>
<li><p>year_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the calendar year interval
(inclusive). Corresponds to 'years' <code>setting</code>.</p></li>
<li><p>year_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the calendar year interval (exclusive).</p></li>
<li><p>age_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the age group (inclusive).
Corresponds to 'ages_asfr' setting.</p></li>
<li><p>age_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the age group (exclusive).</p></li>
<li><p><code>value_col</code>: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>] annual age-specific fertility rate
estimates, must be greater than zero.</p></li>
</ul>

<p>baseline: [<code>data.table()</code>]<br /></p><ul>
<li><p>year: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] mid-year for population estimate.
Corresponds to 'years' <code>setting</code>.</p></li>
<li><p>sex: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>] either 'female' or 'male'. Corresponds to 'sexes'
<code>setting</code>.</p></li>
<li><p>age_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the age group (inclusive).
Corresponds to 'ages' <code>setting</code>.</p></li>
<li><p>age_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the age group (exclusive).</p></li>
<li><p><code>value_col</code>: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>] baseline year population count estimates,
must be greater than zero.</p></li>
</ul>

<p>survival: [<code>data.table()</code>]<br /></p><ul>
<li><p>year_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the calendar year interval
(inclusive). Corresponds to 'years' <code>setting</code>.</p></li>
<li><p>year_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the calendar year interval (exclusive).</p></li>
<li><p>sex: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>] either 'female' or 'male'. Corresponds to 'sexes'
<code>setting</code>.</p></li>
<li><p>age_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the age group (inclusive).
Corresponds to 'ages' <code>setting</code>.</p></li>
<li><p>age_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the age group (exclusive).</p></li>
<li><p><code>value_col</code>: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>] survivorship ratio estimates, must be
greater than zero and less than one.</p></li>
</ul>

<p>net_migration: [<code>data.table()</code>]<br /></p><ul>
<li><p>year_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the calendar year interval
(inclusive). Corresponds to 'years' <code>setting</code>.</p></li>
<li><p>year_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the calendar year interval (exclusive).</p></li>
<li><p>sex: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>] either 'female' or 'male'. Corresponds to 'sexes'
<code>setting</code>.</p></li>
<li><p>age_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the age group (inclusive).
Corresponds to 'ages' <code>setting</code>.</p></li>
<li><p>age_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the age group (exclusive).</p></li>
<li><p><code>value_col</code>: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>] annual net-migration proportion estimates.</p></li>
</ul>

<p>immigration: [<code>data.table()</code>]<br /></p><ul>
<li><p>year_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the calendar year interval
(inclusive). Corresponds to 'years' <code>setting</code>.</p></li>
<li><p>year_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the calendar year interval (exclusive).</p></li>
<li><p>sex: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>] either 'female' or 'male'. Corresponds to 'sexes'
<code>setting</code>.</p></li>
<li><p>age_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the age group (inclusive).
Corresponds to 'ages' <code>setting</code>.</p></li>
<li><p>age_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the age group (exclusive).</p></li>
<li><p><code>value_col</code>: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>] annual immigration proportion estimates,
must be greater than zero.</p></li>
</ul>

<p>emigration: [<code>data.table()</code>]<br /></p><ul>
<li><p>year_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the calendar year interval
(inclusive). Corresponds to 'years' <code>setting</code>.</p></li>
<li><p>year_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the calendar year interval (exclusive).</p></li>
<li><p>sex: [<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>] either 'female' or 'male'. Corresponds to 'sexes'
<code>setting</code>.</p></li>
<li><p>age_start: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] start of the age group (inclusive).
Corresponds to 'ages' <code>setting</code>.</p></li>
<li><p>age_end: [<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>] end of the age group (exclusive).</p></li>
<li><p><code>value_col</code>: [<code><a href='https://rdrr.io/r/base/numeric.html'>numeric()</a></code>] annual emigration proportion estimates, must
be greater than zero.</p></li>
</ul>


    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Wheldon, Mark C., Adrian E. Raftery, Samuel J. Clark, and Patrick Gerland.
2013. “Reconstructing Past Populations With Uncertainty From Fragmentary
Data.” Journal of the American Statistical Association 108 (501): 96–110.
<a href='https://doi.org/10.1080/01621459.2012.737729'>https://doi.org/10.1080/01621459.2012.737729</a>.</p>
<p><a href='https://CRAN.R-project.org/package=popReconstruct'>popReconstruct R Package</a></p>
<p>Wheldon, Mark C., Adrian E. Raftery, Samuel J. Clark, and Patrick Gerland.
2015. “Bayesian Reconstruction of Two-Sex Populations by Age: Estimating Sex
Ratios at Birth and Sex Ratios of Mortality.” Journal of the Royal
Statistical Society. Series A: Statistics in Society 178 (4): 977–1007.
<a href='https://doi.org/10.1111/rssa.12104'>https://doi.org/10.1111/rssa.12104</a>.</p>
<p><a href='https://github.com/markalava/Bayesian-Reconstruction'>markalava/Bayesian-Reconstruction github repo</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/demCore/man/ccmpp.html'>demCore::ccmpp()</a></code></p>
<p><code><a href='https://rdrr.io/pkg/demUtils/man/summarize_dt.html'>demUtils::summarize_dt()</a></code></p>
<p><code><a href='rbindlist_dts.html'>rbindlist_dts()</a></code></p>
<p><code><a href='../articles/popReconstruct.html'>vignette("popReconstruct")</a></code></p>
<p><code><a href='../articles/popReconstruct_options.html'>vignette("popReconstruct_options")</a></code></p>
<p>Other popReconstruct: 
<code><a href='popReconstruct_hyperparameters.html'>popReconstruct_hyperparameters</a>()</code>,
<code><a href='rbindlist_dts.html'>rbindlist_dts</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># specify settings for this example</span>
<span class='kw'>settings</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  years = <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>1960</span>, <span class='fl'>2000</span>, <span class='fl'>5</span>),
  sexes = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"female"</span>),
  ages = <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>0</span>, <span class='fl'>80</span>, <span class='fl'>5</span>),
  ages_survival = <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>0</span>, <span class='fl'>85</span>, <span class='fl'>5</span>),
  ages_asfr = <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>15</span>, <span class='fl'>45</span>, <span class='fl'>5</span>),

  n_draws = <span class='fl'>10</span>
)

<span class='co'># hyperparameters for the variance prior distribution, represents measurement error</span>
<span class='kw'>hyperparameters</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(asfr = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(alpha = <span class='fl'>1</span>, beta = <span class='fl'>0.0109</span>),
                        population = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(alpha = <span class='fl'>1</span>, beta = <span class='fl'>0.0109</span>),
                        survival = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(alpha = <span class='fl'>1</span>, beta = <span class='fl'>0.0109</span>),
                        net_migration = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(alpha = <span class='fl'>1</span>, beta = <span class='fl'>0.0436</span>))

<span class='kw'>fit_stan</span> <span class='op'>&lt;-</span> <span class='kw'>popMethods</span>::<span class='fu'>popReconstruct_fit</span>(
  inputs = <span class='kw'>demCore</span>::<span class='kw'><a href='https://rdrr.io/pkg/demCore/man/burkina_faso.html'>burkina_faso_initial_estimates</a></span>,
  data = <span class='kw'>demCore</span>::<span class='kw'><a href='https://rdrr.io/pkg/demCore/man/burkina_faso.html'>burkina_faso_data</a></span>,
  hyperparameters = <span class='kw'>hyperparameters</span>,
  settings = <span class='kw'>settings</span>,
  value_col = <span class='st'>"value"</span>,
  software = <span class='st'>"stan"</span>,
  chains = <span class='fl'>1</span>,
  iter = <span class='fl'>200</span>,
  warmup = <span class='fl'>100</span>,
  thin = <span class='fl'>2</span>
)
</div><div class='output co'>#&gt; 
#&gt; SAMPLING FOR MODEL 'popReconstruct' NOW (CHAIN 1).
#&gt; Chain 1: 
#&gt; Chain 1: Gradient evaluation took 0.001343 seconds
#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 13.43 seconds.
#&gt; Chain 1: Adjust your expectations accordingly!
#&gt; Chain 1: 
#&gt; Chain 1: 
#&gt; Chain 1: WARNING: There aren't enough warmup iterations to fit the
#&gt; Chain 1:          three stages of adaptation as currently configured.
#&gt; Chain 1:          Reducing each adaptation stage to 15%/75%/10% of
#&gt; Chain 1:          the given number of warmup iterations:
#&gt; Chain 1:            init_buffer = 15
#&gt; Chain 1:            adapt_window = 75
#&gt; Chain 1:            term_buffer = 10
#&gt; Chain 1: 
#&gt; Chain 1: Iteration:   1 / 200 [  0%]  (Warmup)
#&gt; Chain 1: Iteration:  20 / 200 [ 10%]  (Warmup)
#&gt; Chain 1: Iteration:  40 / 200 [ 20%]  (Warmup)
#&gt; Chain 1: Iteration:  60 / 200 [ 30%]  (Warmup)
#&gt; Chain 1: Iteration:  80 / 200 [ 40%]  (Warmup)
#&gt; Chain 1: Iteration: 100 / 200 [ 50%]  (Warmup)
#&gt; Chain 1: Iteration: 101 / 200 [ 50%]  (Sampling)
#&gt; Chain 1: Iteration: 120 / 200 [ 60%]  (Sampling)
#&gt; Chain 1: Iteration: 140 / 200 [ 70%]  (Sampling)
#&gt; Chain 1: Iteration: 160 / 200 [ 80%]  (Sampling)
#&gt; Chain 1: Iteration: 180 / 200 [ 90%]  (Sampling)
#&gt; Chain 1: Iteration: 200 / 200 [100%]  (Sampling)
#&gt; Chain 1: 
#&gt; Chain 1:  Elapsed Time: 5.0462 seconds (Warm-up)
#&gt; Chain 1:                3.53858 seconds (Sampling)
#&gt; Chain 1:                8.58478 seconds (Total)
#&gt; Chain 1: </div><div class='output co'>#&gt; <span class='warning'>Warning: The largest R-hat is NA, indicating chains have not mixed.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#r-hat</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#bulk-ess</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#tail-ess</span></div><div class='input'>
<span class='kw'>draws_stan</span> <span class='op'>&lt;-</span> <span class='kw'>popMethods</span>::<span class='fu'>popReconstruct_posterior_draws</span>(
  fit = <span class='kw'>fit_stan</span>,
  inputs = <span class='kw'>demCore</span>::<span class='kw'><a href='https://rdrr.io/pkg/demCore/man/burkina_faso.html'>burkina_faso_initial_estimates</a></span>,
  settings = <span class='kw'>settings</span>,
  value_col = <span class='st'>"value"</span>,
  software = <span class='st'>"stan"</span>,
  method_name = <span class='st'>"original"</span>
)

<span class='kw'>summary_stan</span> <span class='op'>&lt;-</span> <span class='kw'>popMethods</span>::<span class='fu'>popReconstruct_summarize_draws</span>(
  draws = <span class='kw'>draws_stan</span>
)

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Charlton Callender, Katie Paulson, Spencer Pease, Haidong Wang, Institute for Health Metrics and Evaluation.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


